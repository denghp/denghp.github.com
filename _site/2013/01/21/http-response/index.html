<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv=Content-Type content="text/html;charset=utf-8">
        <meta name="robots" content="all,follow" />
        <title>HTTPResponse实现详解 - 熊猫家族</title>
        <meta name="keywords" content="博客,IT技术,研发实践,互联网,资讯,编程语言,搜索引擎,Lucene,Solr,Java,生活,旅游,吃货,熊猫吃货,微生活,健康,美食"/>
        <meta name="author" lang="en" content="All: Demi-Panda Lab [demi-panda.com]; e-mail: blog.pandam@gmail.com" />
        <meta name="copyright" lang="en" content="@2012 Demi_Panda Lab, All Rights Reserved!" />
        <meta name="description" content="熊猫家族博客：敢想,敢拼,敢赢...博客,IT技术,研发实践,互联网,资讯,编程语言,搜索引擎,Lucene,Solr,Java,生活,旅游,吃货,熊猫吃货,微生活,健康,美食" />
        <meta property="wb:webmaster" content="eb26a33b1e192873" />
        <meta name="chinaz-site-verification" content="54c83ea9-059c-4447-95ec-4dc8b16e60b2" />
        <meta name="baidu_union_verify" content="67d51e25cc69ae324f028d2d333b753a">
        <meta name="chinaz-site-verification" content="081e7651-48c6-4c2f-a569-99321685eab1" />
        <link rel="shortcut icon" href="http://demi-panda.com/media/demi/favicon.ico" type="image/x-icon" />
        <link rel="stylesheet" media="screen,projection" type="text/css" href="http://demi-panda.com/media/demi/css/style.css" />
        <link rel="stylesheet" media="screen,projection" type="text/css" href="http://demi-panda.com/media/demi/css/main.css" />
        <link rel="stylesheet" media="screen,projection" type="text/css" href="http://demi-panda.com/media/demi/css/reset.css" />
        <link rel="stylesheet" media="screen,projection" type="text/css" href="http://demi-panda.com/media/demi/css/superfish.css" />
        <link rel="stylesheet" media="screen,projection" type="text/css" href="http://demi-panda.com/media/demi/css/prettify.css" />
        <link rel='stylesheet' id='pretty-photo-css'  href='http://demi-panda.com/media/demi/css/prettyPhoto-3.4.2.css' type='text/css' media='all' />
        <link rel="alternate" type="application/rss+xml" title="熊猫家族" href="http://demi-panda.com/rss.xml" />
        <script src="http://demi-panda.com/media/js/prettify.js" type="text/javascript"></script>
        <script src="http://demi-panda.com/media/js/jquery-1.6.1.min.js" type="text/javascript"></script>
        <script src="http://demi-panda.com/media/js/jquery.jcarousel.min.js" type="text/javascript"></script>
        <script src="http://demi-panda.com/media/js/jquery.tagcloud.js" type="text/javascript"></script>
        <style type='text/css'>
          code {
            margin: 0 2px;
            padding: 0px 5px;
            border: 1px solid #EAEAEA;
            background-color: #F8F8F8;
            border-radius: 3px;
            font-size: 12px;
            font-family: Consolas, "Liberation Mono", Courier, monospace;
            }
        </style>
    </head>


    <body >

        <div id="wrapper">
            <!-- /header -->
<div id="header">

  <div id="logo">
    <h1 id="logo">
      <a href="/" title="[Go to homepage]"><img width="234px" height="86px" src="/media/demi/img/demi-logo.jpg" alt="" /></a>
    </h1> 
  </div><!-- /logo -->

  <div class="cleared"></div>
</div>
<!-- /header -->

 
            <!-- Tray -->
<div id="tray">
    <ul>
        
        <li ><a href="/">Home</a></li>
        <li id="tray-active" ><a href="/archives/">文章列表</a></li>
        <li><a href="/practice/">研发实践</a></li>
        <li ><a href="/chihuo/">熊猫吃货</a></li>
        <li ><a href="/life/">微生活</a></li>
        <li ><a href="/tags/">标签</a></li>
        <li ><a href="/about/">关于我</a></li>
        
        <li>
        <div id="search">
            <form action="http://www.google.com/cse" class="lit-search" method="get" target="_blank">
                <input type="text" class="text" name="q" size="24" placeholder="搜索">
                <input type="hidden" name="cx" value="007512494910388222978:uvgripsnamg">
                <input type="hidden" name="ie" value="UTF-8">
            </form>
        </div>

        </li>

    </ul>
    <hr class="noscreen" />                    
</div> 
<!-- /tray -->


            <div id="main">
                <div id="content">
  <div class="post type-post status-publish format-standard hentry category-1 post" >
    <div class="posttop">
      <h1 class="posttitle">
        HTTPResponse实现详解
      </h1>
    </div>
    <div class="postmetatop">
      Posted 
      <time class="text" datetime="2013-01-21">2013-01-21 08:20:20</time>&nbsp; |&nbsp;
       <span class="ds-thread-count" data-thread-key="201301211427" data-replace="1">暂无评论</span></a></span> &nbsp;|&nbsp;
      
      By 熊猫人
      
      
      <div class="tag">
        
        <a href="/tags/#HTTP" class="text" title="HTTP" rel="category tag">HTTP</a>&nbsp;
        
        <a href="/tags/#HTTPResponse" class="text" title="HTTPResponse" rel="category tag">HTTPResponse</a>&nbsp;
        
        <a href="/tags/#研发实践" class="text" title="研发实践" rel="category tag">研发实践</a>&nbsp;
        
      </div>
      
    </div>

    <div class="postcontent-entry">
      <div class="cleared"></div>
      <p>　　上一篇介绍了HTTPRequest的详细实现，及主要知识点，这一篇了解下HTTPResponse的主要知识点，及代码实现。</p>

<h3>HTTP协议-状态行</h3>

<p>所有HTTP响应的第一行都是状态行，依次是当前HTTP版本号，3位数字组成的状态代码，以及描述状态的短语，彼此由空格分隔。</p>

<p>状态代码的第一个数字代表当前响应的类型：</p>

<ol>
<li>1xx消息——请求已被服务器接收，继续处理</li>
<li>2xx成功——请求已成功被服务器接收、理解、并接受</li>
<li>3xx重定向——需要后续操作才能完成这一请求</li>
<li>4xx请求错误——请求含有词法错误或者无法被执行</li>
<li>5xx服务器错误——服务器在处理某个正确请求时发生错误</li>
</ol>


<p>详情参考:<a href="http://demi-panda.com/2012/11/21/http-status/" target="_bank" alt="HTTP状态码">HTTP状态码</a></p>

<h3>HTTP协议-消息报头</h3>

<p> 　　HTTP消息由客户端到服务器的请求和服务器到客户端的响应组成。请求消息和响应消息都是由开始行（对于请求消息，开始行就是请求行，对于响应消息，开始行就是状态行），消息报头（可选），空行（只有CRLF的行），消息正文（可选）组成。</p>

<p>HTTP消息报头包括普通报头、请求报头、响应报头、实体报头。
每一个报头域都是由名字+“：”+空格+值 组成，消息报头域的名字是大小写无关的。</p>

<h4>普通报头</h4>

<p>在普通报头中，有少数报头域用于所有的请求和响应消息，但并不用于被传输的实体，只用于传输的消息。</p>

<h4>请求报头</h4>

<p>请求报头允许客户端向服务器端传递请求的附加信息以及客户端自身的信息。</p>

<table style="width:580px">
  <tbody>
    <tr>
      <th style="width:120px">参数:</th>
      <th>描述</th>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td>
      Accept
      </hd>
      <td>
      Accept请求报头域用于指定客户端接受哪些类型的信息。eg：Accept：image/gif，表明客户端希望接受GIF图象格式的资源；Accept：text/html，表明客户端希望接受html文本。
      </td>
    </tr>
    <tr>
      <td>
      Accept-Charset
      </hd>
      <td> 
      Accept-Charset请求报头域用于指定客户端接受的字符集。eg：Accept-Charset:iso-8859-1,gb2312.如果在请求消息中没有设置这个域，缺省是任何字符集都可以接受。
      </td>
    </tr>
    <tr>
      <td>
      Accept-Encoding
      </hd>
      <td> 
      Accept-Encoding请求报头域类似于Accept，但是它是用于指定可接受的内容编码。eg：Accept-Encoding:gzip.deflate.如果请求消息中没有设置这个域服务器假定客户端对各种内容编码都可以接受。
      </td>
    </tr>
    <tr>
      <td>
      Accept-Language
      </hd>
      <td> 
      Accept-Language请求报头域类似于Accept，但是它是用于指定一种自然语言。eg：Accept-Language:zh-cn.如果请求消息中没有设置这个报头域，服务器假定客户端对各种语言都可以接受。
      </td>
    </tr>
    <tr>
      <td>
      Authorization
      </hd>
      <td> 
      请求报头域主要用于证明客户端有权查看某个资源。当浏览器访问一个页面时，如果收到服务器的响应代码为401（未授权），可以发送一个包含Authorization请求报头域的请求，要求服务器对其进行验证。
      Host（发送请求时，该报头域是必需的）,Host请求报头域主要用于指定被请求资源的Internet主机和端口号，它通常从HTTP URL中提取出来的
      </td>
    </tr>
    <tr>
      <td>
    User-Agent
      </hd>
      <td> 
      User-Agent请求报头域允许客户端将它的操作系统、浏览器和其它属性告诉服务器。不过，这个报头域不是必需的，如果我们自己编写一个浏览器，不使用User-Agent请求报头域，那么服务器端就无法得知我们的信息了。
      </td>
    </tr>
</tbody>
</table>


<h4>响应报头</h4>

<p>响应报头允许服务器传递不能放在状态行中的附加响应信息，以及关于服务器的信息和对Request-URI所标识的资源进行下一步访问的信息。</p>

<table style="width:580px">
  <tbody>
    <tr>
      <th style="width:120px">参数:</th>
      <th>描述</th>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td>
      Location
      </hd>
      <td>
      Location响应报头域用于重定向接受者到一个新的位置。Location响应报头域常用在更换域名的时候。
      </td>
    </tr>
    <tr>
      <td>
      Server
      </hd>
      <td> 
      Server响应报头域包含了服务器用来处理请求的软件信息。与User-Agent请求报头域是相对应的。eg:Server：Apache-Coyote/1.1
      </td>
    </tr>
    <tr>
      <td>
      WWW-Authenticate
      </hd>
      <td> 
        WWW-Authenticate响应报头域必须被包含在401（未授权的）响应消息中，客户端收到401响应消息时候，并发送Authorization报头域请求服务器对其进行验证时，服务端响应报头就包含该报头域。
        eg：WWW-Authenticate:Basic realm="Basic Auth Test!"  //可以看出服务器对请求资源采用的是基本验证机制。
      </td>
    </tr>
</tbody>
</table>


<h4>实体报头</h4>

<p>请求和响应消息都可以传送一个实体。一个实体由实体报头域和实体正文组成，但并不是说实体报头域和实体正文要在一起发送，可以只发送实体报头域。实体报头定义了关于实体正文（eg：有无实体正文）和请求所标识的资源的元信息。</p>

<table style="width:580px">
  <tbody>
    <tr>
      <th style="width:120px">参数:</th>
      <th>描述</th>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td>
      Content-Encoding
      </hd>
      <td>
      实体报头域被用作媒体类型的修饰符，它的值指示了已经被应用到实体正文的附加内容的编码，因而要获得Content-Type报头域中所引用的媒体类型，必须采用相应的解码机制。Content-Encoding这样用于记录文档的压缩方法，eg：Content-Encoding：gzip
      </td>
    </tr>
    <tr>
      <td>
      Content-Language
      </hd>
      <td> 
      实体报头域描述了资源所用的自然语言。没有设置该域则认为实体内容将提供给所有的语言阅读者。eg：Content-Language:en
      </td>
    </tr>
    <tr>
      <td>
        Content-Length
      </hd>
      <td> 
      实体报头域用于指明实体正文的长度，以字节方式存储的十进制数字来表示。
      </td>
    </tr>
    <tr>
      <td>
        Content-Length
      </hd>
      <td> 
      实体报头域用于指明实体正文的长度，以字节方式存储的十进制数字来表示。
      </td>
    </tr>
 <tr>
      <td>
      Content-Type
      </hd>
      <td> 
      实体报头域用语指明发送给接收者的实体正文的媒体类型。eg：
      Content-Type:text/html;charset=ISO-8859-1
      </td>
    </tr>
 <tr>
      <td>
      Last-Modified
      </hd>
      <td> 
      实体报头域用于指示资源的最后修改日期和时间。
      </td>
    </tr>
 <tr>
      <td>
      Expires
      </hd>
      <td> 
      实体报头域给出响应过期的日期和时间。
      </td>
    </tr>
</tbody>
</table>


<h3>HTTPResponse代码实现</h3>

<pre id="java">
package com.cpy.nio.broker.http;

import static com.cpy.nio.broker.utils.Utils.*;
import java.io.*;
import java.nio.ByteBuffer;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.TimeZone;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.util.zip.GZIPInputStream;

public class HttpResponse {

  public static final byte[] ST_OK = "200 OK\r\n".getBytes();
  private byte[] status;
  private ArrayList<String> keys = new ArrayList<String>();
  private ArrayList<String> values = new ArrayList<String>();
  public static final SimpleDateFormat gmtdf;
  public ByteBuffer buffer;
  private int contentOffset;
  private int contentLength;
  private int iread;
  public int versionRange;
  public int statusRange;
  public int reasonRange;

  static {
    gmtdf = new SimpleDateFormat("EEE, dd MMM yyyy hh:mm:ss");
    gmtdf.setTimeZone(TimeZone.getTimeZone("GMT:00"));
  }

  public HttpResponse() {
    this(ST_OK);
  }

  public HttpResponse(byte[] statusb) {
    this.status = statusb;
    this.buffer = ByteBuffer.allocate(64 * 102400);
  }

  public void setStatus(String statusMsg) {
    if (!statusMsg.endsWith("\r\n")) {
      statusMsg = statusMsg + "\r\n";
    }
    this.status = statusMsg.getBytes();
  }

  public HttpResponse(String statusMsg) {
    this();
    this.setStatus(statusMsg);
  }

  public HttpResponse addField(String key, String value) {
    this.keys.add(key);
    this.values.add(value);
    return this;
  }

  public HttpResponse addField(String key, int valRange) {
    this.keys.add(key);
    this.values.add(this.extractRange(valRange));
    return this;
  }

  public void readFrom(EndPoint endpoint) throws Exception {
    this.iread = 0;
    this.readHeader(endpoint);
    this.readBody(endpoint);
  }

  private void readHeader(EndPoint endpoint) throws Exception {

    int headerLength = 0;
    int n;
    do {
      n = this.readLine(endpoint); // includes 2 bytes for CRLF
      headerLength += n;
    } while (n > 2); // until blank line (CRLF)
    // dumpBuffer(buffer);
    HttpResponseParser.initHeader(this, headerLength);
    this.contentOffset = headerLength; // doesn't mean there's necessarily
    // any content.
    String cl = this.getHeader("Content-Length");
    if (cl.length() > 0) {
      try {
        this.contentLength = Integer.parseInt(cl);
      } catch (NumberFormatException nfe) {
        throw new IOException("Malformed Content-Length hdr");
      }
    } else if (this.getHeader("Transfer-Encoding").indexOf("chunked") >= 0
            || this.getHeader("TE").indexOf("chunked") >= 0) {
      this.contentLength = -1;
    } else {
      this.contentLength = 0;
    }
  }

  private int readLine(EndPoint endpoint) throws Exception {
    int ireadSave = this.iread;
    int i = ireadSave;
    while (true) {
      int end = this.buffer.position();
      byte[] bufa = this.buffer.array();
      for (; i < end; i++) {
        if (bufa[i] == CR) {
          ++i;
          if (i >= end) {
            this.buffer = endpoint.fill(this.buffer, 1);
            bufa = this.buffer.array(); // fill could have changed
            // the buffer.
            end = this.buffer.position();
          }
          if (bufa[i] != LF) {
            throw new IOException("Expected LF at " + i + " but was " + bufa[i]);
            // ++i;
            // continue;
          }
          ++i;
          int lineLength = i - ireadSave;
          this.iread = i;
          return lineLength;
        }
      }
      this.buffer = endpoint.fill(this.buffer, 1); // no CRLF found. fill
      // a bit more and start
      // over.
    }
  }

  private void readBody(EndPoint endpoint) throws Exception {
    this.iread = this.contentOffset;
    if (this.contentLength > 0) {
      this.fill(endpoint, this.contentOffset, this.contentLength);
      this.iread = this.contentOffset + this.contentLength;
    } else if (this.contentLength == -1) {
      this.readAllChunks(endpoint);
    }
    this.readTrailers(endpoint);
  }

  private void readTrailers(EndPoint endpoint) {
  }

  private void fill(EndPoint endpoint, int offset, int size) throws Exception {
    int total = offset + size;
    int currentPos = this.buffer.position();
    if (total > this.buffer.position()) {
      this.buffer = endpoint.fill(this.buffer, (total - currentPos));
    }
  }

  private void readAllChunks(EndPoint endpoint) throws Exception {
    IntList chunkRanges = new IntList(); // alternate numbers in this list
    // refer to the start and end
    // offsets of chunks.
    try {
      do {
        int n = this.readLine(endpoint); // read chunk size text into
        // buffer
        int beg = this.iread;
        int size = parseChunkSize(this.buffer, this.iread - n, this.iread); // Parse
        // size
        // in
        // hex,
        // ignore
        // extension

        if (size == 0) {
          break;
        }
        // If the chunk has not already been read in, do so
        this.fill(endpoint, this.iread, size + 2 /* chunksize + CRLF */);
        // record chunk start and end
        chunkRanges.add(beg);
        chunkRanges.add(beg + size); // without the CRLF
        this.iread += size + 2; // for the next round.
      } while (true);
    } catch (Throwable e) {
      e.printStackTrace();
    }

    // / consolidate all chunkRanges
    if (chunkRanges.numElements == 0) {
      this.contentLength = 0;
      return;
    }
    this.contentOffset = chunkRanges.get(0); // first chunk's beginning
    int endOfLastChunk = chunkRanges.get(1); // first chunk's end

    byte[] bufa = this.buffer.array();
    for (int i = 2; i < chunkRanges.numElements; i += 2) {
      int beg = chunkRanges.get(i);
      int chunkSize = chunkRanges.get(i + 1) - beg;
      System.arraycopy(bufa, beg, bufa, endOfLastChunk, chunkSize);
      endOfLastChunk += chunkSize;
    }

    this.contentLength = endOfLastChunk - this.contentOffset;
    // At this point, the contentOffset and contentLen give the entire
    // content
  }

  /**
   * Get the value for a given key
   *
   * @param key
   * @return null if the key is not present in the header.
   */
  public String getHeader(String key) {
    for (int i = 0; i < this.keys.size(); i++) {
      if (key.equalsIgnoreCase(this.keys.get(i))) {
        return this.values.get(i);
      }
    }
    return ""; // no point returning null
  }

  public void setContentLength(long length) {
    this.addField("Content-Length", Long.toString(length));
  }

  public void setContentType(String contentType) {
    this.addField("Content-Type", contentType);
  }

  public String status() {
    return this.extractRange(this.statusRange);
  }

  public String reason() {
    return this.extractRange(this.reasonRange);
  }

  private String extractRange(int range) {
    int beg = range >> 16;
    int end = range & 0xFFFF;
    return this.extractRange(beg, end);
  }

  public String extractRange(int beg, int end) {
    try {
      return new String(this.buffer.array(), beg, (end - beg), "UTF-8");
    } catch (Exception e) {
      e.printStackTrace();
    }
    return null;
  }
  private static final Pattern charsetRegex = Pattern.compile("charset=([0-9A-Za-z-]+)");

  public String charset() {
    String contentType = this.getHeader("Content-Type");
    String charset = null;
    Matcher matcher = this.charsetRegex.matcher(contentType);
    if (matcher.find()) {
      charset = matcher.group(1);
    } else {
      charset = "utf-8";
    }
    return charset;
  }

  /**
   * Get the response content
   *
   * @return
   */
  public String content() {
    if (this.isGZipContent()) {
      return this.uncompress(this.buffer.array(), this.contentOffset, this.contentLength);
    } else {
      try {
        return new String(this.buffer.array(), this.contentOffset, this.contentLength, this.charset());
      } catch (UnsupportedEncodingException e) {
        throw new RuntimeException(e);
      }
    }

  }

  /**
   * Check if contents are gzip compressed.
   *
   * @return
   */
  public boolean isGZipContent() {
    final String encoding = this.getHeader("Content-Encoding");
    if (null != encoding) {
      if (encoding.toLowerCase().indexOf("gzip") > -1) {
        return true;
      }
    }
    return false;
  }

  /**
   * Uncompress the content
   *
   * @param buf
   * @param offset
   * @param length
   * @return
   */
  private String uncompress(byte[] buf, int offset, int length) {

    InputStream is = null;
    GZIPInputStream gzin = null;
    InputStreamReader isr = null;
    BufferedReader br = null;
    StringBuilder sb = new StringBuilder();
    try {
      is = new ByteArrayInputStream(buf, offset, length);
      gzin = new GZIPInputStream(is);
      isr = new InputStreamReader(gzin, this.charset());
      br = new BufferedReader(isr);
      char[] buffer = new char[4096];
      int readlen = -1;
      while ((readlen = br.read(buffer, 0, 4096)) != -1) {
        sb.append(buffer, 0, readlen);
      }
    } catch (Exception e) {
      e.printStackTrace();
    } finally {
      try {
        br.close();
      } catch (Exception e1) {
        // ignore
      }
      try {
        isr.close();
      } catch (Exception e1) {
        // ignore
      }
      try {
        gzin.close();
      } catch (Exception e1) {
        // ignore
      }
      try {
        is.close();
      } catch (Exception e1) {
        // ignore
      }
    }
    return sb.toString();
  }
}
</pre>


<h3>HTTPResponse代码实现-EndPoint</h3>

<pre id="java">
package com.cpy.nio.broker.http;

import java.nio.ByteBuffer;
import java.nio.channels.SocketChannel;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class EndPoint {
  static final int YIELD_COUNT = 4;
  private Logger logger = LoggerFactory.getLogger(EndPoint.class);
  
  private SocketChannel socketChannel;

  public EndPoint(SocketChannel socketChannel) {
    this.socketChannel = socketChannel;
  }

  public ByteBuffer fill(ByteBuffer buf, int atLeast) throws Exception {
    if (buf.remaining() < atLeast) {
      ByteBuffer newByteBuffer = ByteBuffer.allocate(Math.max(buf.capacity() * 3 / 2, buf.position() + atLeast));
      buf.flip();
      newByteBuffer.put(buf);
      buf = newByteBuffer;
    }
    SocketChannel ch = this.socketChannel;
    if (!ch.isOpen()) {
      //throw new EOFException();
      logger.warn("EOFException SocketChannel is close.");
    }
    int yieldCount = 0;
    do {
      int n = ch.read(buf);
      if (n == 0) {
        //break;
        //TODO:在程序压力大的情况下有可能socket的接受数据无法正常响应过来,结果导致n==0,原来使用break,但是会导致数据丢失,就会产生\u0000,
        //解决方案：使当前处理的线程从执行状态转换成可执行状态,处理3次,如果3次都为0,则表示读取完成
        if (++yieldCount < YIELD_COUNT) {
          Thread.currentThread().yield();
        }
      }
      if (n == -1 && this != null) {
        this.close();
        break;
      }
      atLeast -= n;

    } while (atLeast > 0);

    return buf;
  }

  public void close() {
    try {

      this.socketChannel.close();
    } catch (Exception e) {
      e.printStackTrace();
    }
  }
}
</pre>


    </div><!-- /postcontent -->

    <div class="v-pagination">
      
      
      <a class="prev" href="/2013/01/21/http-request" title="前一篇：HTTPRequest实现详解">&laquo; HTTPRequest实现详解</a>
      
      
      
       
      <a class="next" href="/2013/01/22/github-shield" title="后一篇：GitHub网站及关键字被屏蔽">GitHub网站及关键字被屏蔽 &raquo;</a>
      
      
    </div>
    
    <!-- JiaThis Button BEGIN -->
    <div class="jiathis_style" style="margin: 10px 10px 20px 0;padding: 10px 0 0;">
      <span class="jiathis_txt">分享到：</span>
      <a class="jiathis_button_qzone">QQ空间</a>
      <a class="jiathis_button_tsina">新浪微博</a>
      <a class="jiathis_button_tqq">腾讯微博</a>
      <a class="jiathis_button_renren">人人网</a>
      <a class="jiathis_button_googleplus">Google+</a>
      <a href="http://www.jiathis.com/share?uid=1706288" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
      <a class="jiathis_counter_style"></a>
    </div>
    <script type="text/javascript">
      var jiathis_config = {data_track_clickback:true};
    </script>
    <script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1343704647947962" charset="utf-8"></script>
    <!-- JiaThis Button END -->
 </div><!-- /post -->
  <div class="cleared"></div>
 
  <div class="archivesbox">
    <b>版权声明：</b>自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">Creative Commons BY-NC-ND 3.0</a><br>
    <b>原文网址：</b><a href="/2013/01/21/http-response">http://demi-panda.com/2013/01/21/http-response</a>
  </div>

  <div class="archivesbox">
    <div class="comments">
      <!-- Duoshuo Comment Begin -->
      <div class="ds-thread" data-thread-id="201301211427" data-url="http://demi-panda.com/2013/01/21/http-response" data-thread-key="201301211427" data-title="HTTPResponse实现详解"
        data-order="desc" data-form-positon="top"></div>
      <!-- Duoshuo Comment End -->
    </div>
  </div>
</div><!-- /content -->

<div id="sidebar">
    <ul> 
        <li id="rss-feed" class="boxed widget ds-widget-qqt-follow">
        <h2 class="widgettitle">RSS Feed</h2>
            <a href="/rss.xml" target="_blank"><img src="/media/demi/img/feed.png"  alt="熊猫家族 RSS feed" border="0" title="Subscribe for Updates"></a>
            熊猫家族-建设一个有家氛围的博客园
        </li>
        <li id="tag_cloud" class="boxed widget widget_tag_cloud">
        <h2 class="widgettitle">分类目录</h2>
        
        
        
        
        
        
        
        
        
        
        
        
         
        <a href='/practice' class='tag-link-102' title='code' style='font-size: 14pt;'>研发实践(102)</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/life' class='tag-link-34' title='life' style='font-size: 14pt;'>微生活(34)</a>
        
        
        
        
        
        
        
        
        
        
        
        
         
        <a href='/categories/java' class='tag-link-18' title='java' style='font-size: 14pt;'>Java语言(18)</a>
        
        
        
        
        
        <a href='/categories/solr' class='tag-link-14' title='solr' style='font-size: 14pt;'>Lucene/Solr(14)</a>
        
        
        
        
        
        <a href='/categories/linux' class='tag-link-43' title='linux' style='font-size: 15pt;'>Uinx/Linux(43)</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        </li>

        <li id="tag_cloud" class="boxed widget widget_tag_cloud">
        <h2 class="widgettitle">热门标签</h2>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#Google' class='tag-link-4' title='Google' style='font-size: 16pt;'>Google</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#HTTP' class='tag-link-4' title='HTTP' style='font-size: 14pt;'>HTTP</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#生活' class='tag-link-7' title='生活' style='font-size: 16pt;'>生活</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#项目管理' class='tag-link-3' title='项目管理' style='font-size: 22pt;'>项目管理</a>
        
        
        
        
        
        
        
        <a href='/tags/#健康' class='tag-link-4' title='健康' style='font-size: 16pt;'>健康</a>
        
        
        
        
        
        
        
        <a href='/tags/#Github' class='tag-link-6' title='Github' style='font-size: 16pt;'>Github</a>
        
        
        
        <a href='/tags/#搜索引擎' class='tag-link-14' title='搜索引擎' style='font-size: 22pt;'>搜索引擎</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#CentOS' class='tag-link-3' title='CentOS' style='font-size: 16pt;'>CentOS</a>
        
        
        
        
        
        <a href='/tags/#屏蔽' class='tag-link-3' title='屏蔽' style='font-size: 16pt;'>屏蔽</a>
        
        
        
        
        
        
        
        <a href='/tags/#监控' class='tag-link-3' title='监控' style='font-size: 16pt;'>监控</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#SSH' class='tag-link-3' title='SSH' style='font-size: 13pt;'>SSH</a>
        
        
        
        
        
        
        
        <a href='/tags/#lucene' class='tag-link-14' title='lucene' style='font-size: 16pt;'>lucene</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#Ubuntu' class='tag-link-23' title='Ubuntu' style='font-size: 16pt;'>Ubuntu</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#浏览器' class='tag-link-3' title='浏览器' style='font-size: 19pt;'>浏览器</a>
        
        
        
        
        
        
        
        <a href='/tags/#Subversion' class='tag-link-3' title='Subversion' style='font-size: 20pt;'>Subversion</a>
        
        
        
        <a href='/tags/#熊猫厨房' class='tag-link-6' title='熊猫厨房' style='font-size: 22pt;'>熊猫厨房</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#Jekyll' class='tag-link-6' title='Jekyll' style='font-size: 16pt;'>Jekyll</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#vim' class='tag-link-5' title='vim' style='font-size: 13pt;'>vim</a>
        
        
        
        
        
        <a href='/tags/#域名' class='tag-link-3' title='域名' style='font-size: 16pt;'>域名</a>
        
        
        
        <a href='/tags/#shell' class='tag-link-37' title='shell' style='font-size: 15pt;'>shell</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#互联网' class='tag-link-11' title='互联网' style='font-size: 19pt;'>互联网</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#redmine' class='tag-link-3' title='redmine' style='font-size: 17pt;'>redmine</a>
        
        
        
        
        
        <a href='/tags/#java' class='tag-link-11' title='java' style='font-size: 14pt;'>java</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#Python' class='tag-link-3' title='Python' style='font-size: 16pt;'>Python</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#研发实践' class='tag-link-20' title='研发实践' style='font-size: 22pt;'>研发实践</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#linux' class='tag-link-49' title='linux' style='font-size: 15pt;'>linux</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#梦想' class='tag-link-4' title='梦想' style='font-size: 16pt;'>梦想</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <a href='/tags/#solr' class='tag-link-14' title='solr' style='font-size: 14pt;'>solr</a>
        
        
        
        
        
        
        
        
        
        <a href='/tags/#Jenkins' class='tag-link-3' title='Jenkins' style='font-size: 17pt;'>Jenkins</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        </li>
        <li id="recent-posts-2" class="boxed widget widget_recent_entries">		
        <h2 class="widgettitle">近期文章</h2>	
        <div id="hot_comment_post">
            <ul>
                 
                <li>
                <a href="/2013/07/29/tools-jar-is-not-in-idea-classpath" title="Tools Jar Is Not In Idea Classpath">Tools Jar Is Not In Idea Classpath</a>
                </li>
                 
                <li>
                <a href="/2013/07/24/install-wine-on-ubuntu-and-linux-mint" title="Wine 1.6 Released – Install on Ubuntu 13.04/12.10/12.04/11.10 and Linux Mint 15/13">Wine 1.6 Released – Install on Ubuntu 13.04/12.10/12.04/11.10 and Linux Mint 15/13</a>
                </li>
                 
                <li>
                <a href="/2013/06/29/incompatible-character-encodings-utf-8-and-ascii-8bit" title="Redmine incompatible character encodings UTF-8 and ASCII-8BIT">Redmine incompatible character encodings UTF-8 and ASCII-8BIT</a>
                </li>
                 
                <li>
                <a href="/2013/06/28/java-exec-linux-command" title="Java使用Runtime执行Linux命令用管理连接问题">Java使用Runtime执行Linux命令用管理连接问题</a>
                </li>
                 
                <li>
                <a href="/2013/06/26/Redmine-CKEditor-plugin" title="Redmine高级编辑插件-CKEditor">Redmine高级编辑插件-CKEditor</a>
                </li>
                 
                <li>
                <a href="/2013/06/21/ubuntu-install-redmine" title="Ubuntu 安装Redmine">Ubuntu 安装Redmine</a>
                </li>
                 
                <li>
                <a href="/2013/05/22/linux-install-python-pil" title="Linux 64位系统安装Python PIL模块">Linux 64位系统安装Python PIL模块</a>
                </li>
                 
                <li>
                <a href="/2013/05/21/centos-install-python-2.7" title="Centos 安装Django开发环境">Centos 安装Django开发环境</a>
                </li>
                 
                <li>
                <a href="/2013/05/16/linux-vmstat" title="Linux系统监控工具之vmstat详解">Linux系统监控工具之vmstat详解</a>
                </li>
                 
                <li>
                <a href="/2013/05/13/photography-listing" title="摄影书籍下载大全">摄影书籍下载大全</a>
                </li>
                
            </ul>
        </div>

        </li>
        <li id="ds-top-threads" class="boxed widget ds-widget-top-threads">
        <h2 class="widgettitle">热评文章</h2>
        <div id="hot_comment_post">
            <ul class="ds-top-threads" data-num-items="10" data-range="weekly"></ul>
        </div>
        </li>
        <li id="ds-recent-comments" class="boxed widget ds-widget-recent-comments">
        <h2 class="widgettitle">近期评论</h2>
        <div id="hot_comment">
            <ul class="ds-recent-comments" data-num-items="10" data-show-avatars="1" data-show-time="1" data-show-title="0" data-show-admin="0" data-avatar-size="32" data-excerpt-length="70">
            </ul>
        </div>
        </li>
        <li id="ds-qqt-follow" class="boxed widget ds-widget-qqt-follow">
        <!--
        <iframe src="http://follow.v.t.qq.com/index.php?c=follow&a=quick&name=denghp_280606790&style=1&t=1352387427769&f=1" frameborder="0" scrolling="auto" width="227" height="75" marginwidth="0" marginheight="0" allowtransparency="true"></iframe>
        -->
        <iframe width="300" height="190" frameborder="0" scrolling="no" src="http://widget.weibo.com/relationship/bulkfollow.php?language=zh_cn&uids=1655072963&wide=1" marginwidth="0" marginheight="0" allowtransparency="true"></iframe>
        </li>

        <li id="ds-recent-visitors-2" class="boxed widget ds-widget-recent-visitors">
        <h2 class="widgettitle">最近访客</h2>
        <ul class="ds-recent-visitors" data-num-items="20" data-show-time="0" data-avatar-size="50"></ul>
        </li>
        
        <li id="ds-top-threads" class="boxed widget ds-widget-top-threads">
        <h2 class="widgettitle">友情链接</h2>
        <div id="hot_comment_post">
            <ul>
                
                <li><a href="http://lusongsong.com/"target="_blank"  title="卢松松-关注站长和搜索引擎的IT博客">卢松松</a></li>
                
                <li><a href="http://www.muchangqing.com/"target="_blank"  title="牟长青-牟长青的网站推广博客">牟长青</a></li>
                
                <li><a href="http://coolshell.cn/"target="_blank"  title="酷壳-享受编程和技术所带来的快乐">酷壳</a></li>
                
                <li><a href="http://yanping.me/"target="_blank"  title="雁起平沙-雁起平沙的网络日志">雁起平沙</a></li>
                
                <li><a href="http://www.letuknowit.com/"target="_blank"  title="知蚁博客">知蚁博客</a></li>
                
                <li><a href="http://www.zhangyuchang.com/"target="_blank"  title="不纯粹文人-不经一番寒彻骨，哪得梅花扑鼻香">不纯粹文人</a></li>
                
                <li><a href="http://chenpeng.info/"target="_blank"  title="陈鹏个人博客">陈鹏个人博客</a></li>
                
                <li><a href="http://www.kandisheng.com/"target="_blank"  title="不霁何虹博客">不霁何虹博客</a></li>
                
                <li><a href="http://blog.jobbole.com/"target="_blank"  title="伯乐在线">伯乐在线</a></li>
                
            </ul> 
        </div>
        </li>
        
    </ul>
</div>
<!-- /sidebar -->
<div class="cleared"></div>




  
            </div> 
        </div> <!-- wrapper -->
        
        <!-- scroll.html -->
        <div id="full" style="display:none;width:50px; height:95px; position:fixed; left:50%; top:480px; margin-left:425px;  z-index:100; text-align:center; cursor:pointer;">
    <a><img src="http://demi-panda.com/media/demi/img/back-top.png" border=0 alt="返回顶部" title="返回顶部"></a>
</div>
<script type="text/javascript">
    var isie6 = window.XMLHttpRequest ? false : true; function newtoponload() { var c = document.getElementById("full"); function b() { var a = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop; if (a > 0) { if (isie6) { c.style.display = "none"; clearTimeout(window.show); window.show = setTimeout(function () { var d = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop; if (d > 0) { c.style.display = "block"; c.style.top = (480 + d) + "px" } }, 400) } else { c.style.display = "block" } } else { c.style.display = "none" } } if (isie6) { c.style.position = "absolute" } window.onscroll = b; b() } if (window.attachEvent) { window.attachEvent("onload", newtoponload) } else { window.addEventListener("load", newtoponload, false) } document.getElementById("full").onclick = function () { window.scrollTo(0, 0) };
</script>




       
        <!-- footer -->
        <footer>
<div id="footer">                                          
  <p class="t-center" style='font-size: 10pt;'>
  &copy; 2012 <a href="/">Demi Panda Lab</a>, All Rights Reserved.

  <script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F9ed8ee65a576b9495a4d989eabbd4c09' type='text/javascript'%3E%3C/script%3E"));
  </script>

  <script src="http://s14.cnzz.com/stat.php?id=4734788&web_id=4734788&show=pic" language="JavaScript"></script>
  </p>
  </div> 
</footer>

 
        <script type="text/javascript">
            var duoshuoQuery = {short_name:"demi-panda"};
(function() {
 var ds = document.createElement('script');
 ds.type = 'text/javascript';ds.async = true;
 ds.src = 'http://static.duoshuo.com/embed.js';
 ds.charset = 'UTF-8';
 (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
 })();
</script>  


<script type="text/javascript">
    $(window).load(function(){
            $("pre").addClass("prettyprint");
            prettyPrint();
            })
        </script>

        <script language="javascript">
            $.fn.tagcloud.defaults = {
                size: {start: 0.9, end: 2, unit: 'em'},
                color: {start: '#e77471', end: '#f62817'}
            };

            $(function () {
                $('#tagcloud a').tagcloud();
            });
        </script>  

        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-36197302-1']);
            _gaq.push(['_trackPageview']);

            (function() {
             var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
             ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
             var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
             })();

         </script>
         <script type='text/javascript' src='http://demi-panda.com/media/js/jquery.prettyPhoto-3.4.2.js'></script>
         <script type='text/javascript' src='http://demi-panda.com/media/js/themify.script-3.4.2.js'></script> 
     </body>
 </html>

